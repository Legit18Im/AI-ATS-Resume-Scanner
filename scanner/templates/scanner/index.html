<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ATS Scanner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        
        .navbar { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .navbar-brand { font-weight: 700; letter-spacing: 0.5px; }
        
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        
        .score-circle { 
            width: 160px; height: 160px; border-radius: 50%; 
            background: conic-gradient(#28a745 var(--percent), #e9ecef 0);
            display: flex; align-items: center; justify-content: center; 
            margin: 0 auto; position: relative;
        }
        .score-circle::before {
            content: ""; position: absolute; width: 140px; height: 140px; 
            border-radius: 50%; background: white;
        }
        .score-text { position: relative; font-size: 2.5rem; font-weight: 700; color: #333; }
        
        .badge-soft-success { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .badge-soft-danger { background-color: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }
        
        .upload-area { border: 2px dashed #dee2e6; border-radius: 10px; padding: 20px; text-align: center; background: #f8f9fa; cursor: pointer; transition: border-color 0.3s; }
        .upload-area:hover { border-color: #2a5298; background: #fff; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark mb-5">
    <div class="container">
        <a class="navbar-brand" href="/"><i class="fas fa-robot me-2"></i>AI ATS Scanner</a>
        <a href="/about" class="nav-link text-white ms-3 me-auto opacity-75 hover-opacity-100">About Project</a>
        
        <div class="d-flex align-items-center">
            {% if user.is_authenticated %}
                <span class="text-white me-3 d-none d-md-block"><i class="fas fa-user-circle me-1"></i> {{ user.username }}</span>
                <a href="/" class="btn btn-outline-light btn-sm me-2">New Scan</a>
                <a href="/history" class="btn btn-light btn-sm me-2 text-primary fw-bold">My History</a>
                <a href="/logout" class="btn btn-danger btn-sm"><i class="fas fa-sign-out-alt"></i></a>
            {% else %}
                <a href="/login" class="btn btn-outline-light btn-sm me-2">Login</a>
                <a href="/signup" class="btn btn-light btn-sm text-primary fw-bold">Sign Up</a>
            {% endif %}
        </div>
    </div>
</nav>

<div class="container pb-5">
    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card p-4 h-100">
                <h4 class="mb-3 fw-bold text-primary"><i class="fas fa-file-upload me-2"></i>Scan Candidate</h4>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold text-muted small text-uppercase">1. Upload Resume</label>
                        <input type="file" name="resume" class="form-control" required accept=".pdf,.docx,.txt">
                        <div class="form-text"><i class="fas fa-info-circle"></i> Supports PDF, DOCX, TXT</div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold text-muted small text-uppercase">2. Job Description</label>
                        <textarea name="jd_text" class="form-control" rows="10" placeholder="Paste the Job Description text here..." required style="resize: none;"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold shadow-sm">
                        <i class="fas fa-search me-2"></i>Analyze Resume
                    </button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            {% if result %}
            <div class="card p-4 fade-in-up">
                <div class="text-center mb-5">
                    {% if ats_score.score >= 80 %}
                        <div class="score-circle" style="--percent: {{ ats_score.score }}% 0; background: conic-gradient(#28a745 {{ ats_score.score }}%, #e9ecef 0);">
                    {% elif ats_score.score >= 50 %}
                        <div class="score-circle" style="--percent: {{ ats_score.score }}% 0; background: conic-gradient(#ffc107 {{ ats_score.score }}%, #e9ecef 0);">
                    {% else %}
                        <div class="score-circle" style="--percent: {{ ats_score.score }}% 0; background: conic-gradient(#dc3545 {{ ats_score.score }}%, #e9ecef 0);">
                    {% endif %}
                        <span class="score-text">{{ ats_score.score }}%</span>
                    </div>
                    
                    <h3 class="mt-3 fw-bold">Match Score</h3>
                    <p class="text-muted">
                        <i class="fas fa-user me-1"></i> {{ basic_info.name }} &nbsp;|&nbsp; 
                        <i class="fas fa-envelope me-1"></i> {{ basic_info.email }}
                    </p>
                </div>

                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="p-4 bg-light rounded-3 h-100 border">
                            <h5 class="text-success fw-bold mb-3"><i class="fas fa-check-circle me-2"></i>Matched Skills</h5>
                            <div class="d-flex flex-wrap gap-2">
                                {% for skill in matched_skills %}
                                    <span class="badge badge-soft-success px-3 py-2">{{ skill|title }}</span>
                                {% empty %}
                                    <p class="text-muted small fst-italic">No direct skill matches found.</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="p-4 bg-light rounded-3 h-100 border">
                            <h5 class="text-danger fw-bold mb-3"><i class="fas fa-times-circle me-2"></i>Missing Skills</h5>
                            <div class="d-flex flex-wrap gap-2">
                                {% for skill in missing_skills %}
                                    <span class="badge badge-soft-danger px-3 py-2">{{ skill|title }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                {% if tips %}
                <div class="mt-5">
                    <h5 class="fw-bold text-warning text-dark"><i class="fas fa-lightbulb me-2"></i>AI Recommendations</h5>
                    <ul class="list-group list-group-flush border rounded">
                        {% for tip in tips %}
                            <li class="list-group-item border-0"><i class="fas fa-angle-right me-2 text-muted"></i>{{ tip }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if jobs %}
                <div class="mt-5">
                    <h5 class="fw-bold text-secondary"><i class="fas fa-briefcase me-2"></i>Alternative Job Roles</h5>
                    <div class="list-group">
                        {% for job in jobs %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ job.job_title }}</span>
                                <span class="badge bg-primary rounded-pill">{{ job.match_score }}% Match</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="card p-5 text-center h-100 d-flex align-items-center justify-content-center">
                <div class="text-muted opacity-50 mb-3">
                    <i class="fas fa-file-alt fa-5x"></i>
                </div>
                <h3 class="fw-bold text-secondary">Ready to Analyze</h3>
                <p class="text-muted" style="max-width: 400px;">Upload a resume PDF/DOCX and a job description on the left to generate a detailed AI-powered gap analysis.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

</body>
</html>